<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Framework Performance Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0b;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 20px;
            border-bottom: 1px solid #333;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            color: #00d4ff;
        }
        
        .header p {
            color: #888;
            font-size: 14px;
        }
        
        .status-bar {
            background: #1a1a1a;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }
        
        .status-dot.warning { background: #ff9500; }
        .status-dot.critical { background: #ff4757; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .main-content {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .metric-card {
            background: linear-gradient(145deg, #1a1a1a, #222);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            transition: transform 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            border-color: #555;
        }
        
        .metric-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .metric-title {
            font-size: 18px;
            font-weight: 600;
            color: #00d4ff;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-unit {
            font-size: 14px;
            color: #888;
            margin-left: 5px;
        }
        
        .metric-change {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 8px;
            display: inline-block;
        }
        
        .metric-change.positive {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
        }
        
        .metric-change.negative {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        
        .chart-container {
            height: 200px;
            margin-top: 15px;
            position: relative;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .alert-panel {
            background: linear-gradient(145deg, #2d1b1b, #3a1f1f);
            border: 1px solid #ff4757;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-panel.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-title {
            color: #ff4757;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .system-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .system-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .system-value {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .connection-status.connected {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }
        
        .connection-status.disconnected {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid #ff4757;
        }
        
        .footer {
            background: #1a1a1a;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #333;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <div class="header">
        <h1>üöÄ LLM Framework Performance Dashboard</h1>
        <p>Real-time monitoring and performance analytics</p>
    </div>
    
    <div class="status-bar">
        <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">System Operating Normally</span>
        </div>
        <div id="lastUpdate">Last updated: --</div>
    </div>
    
    <div class="alert-panel" id="alertPanel">
        <div class="alert-title" id="alertTitle">System Alert</div>
        <div id="alertMessage">Alert message will appear here</div>
    </div>
    
    <div class="main-content">
        <!-- Memory Metrics -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">üß† Memory Usage</div>
            </div>
            <div class="metric-value" id="memoryUsage">--<span class="metric-unit">MB</span></div>
            <div class="metric-change" id="memoryChange">-- MB change</div>
            <div class="chart-container">
                <canvas class="chart-canvas" id="memoryChart"></canvas>
            </div>
        </div>
        
        <!-- CPU Metrics -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">‚öôÔ∏è CPU Usage</div>
            </div>
            <div class="metric-value" id="cpuUsage">--%</div>
            <div class="metric-change" id="cpuChange">-- % change</div>
            <div class="chart-container">
                <canvas class="chart-canvas" id="cpuChart"></canvas>
            </div>
        </div>
        
        <!-- API Response Times -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">üìä API Response Time</div>
            </div>
            <div class="metric-value" id="apiResponseTime">--<span class="metric-unit">ms</span></div>
            <div class="metric-change" id="apiChange">-- ms change</div>
            <div class="chart-container">
                <canvas class="chart-canvas" id="apiChart"></canvas>
            </div>
        </div>
        
        <!-- Memory Operations -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">üíæ Memory Operations</div>
            </div>
            <div class="metric-value" id="memoryOps">--<span class="metric-unit">ops/sec</span></div>
            <div class="metric-change" id="memoryOpsChange">-- ops change</div>
            <div class="chart-container">
                <canvas class="chart-canvas" id="memoryOpsChart"></canvas>
            </div>
        </div>
        
        <!-- System Information -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">üíª System Information</div>
            </div>
            <div class="systems-grid">
                <div class="system-item">
                    <div class="system-label">Uptime</div>
                    <div class="system-value" id="uptime">--</div>
                </div>
                <div class="system-item">
                    <div class="system-label">Platform</div>
                    <div class="system-value" id="platform">--</div>
                </div>
                <div class="system-item">
                    <div class="system-label">Node Version</div>
                    <div class="system-value" id="nodeVersion">--</div>
                </div>
                <div class="system-item">
                    <div class="system-label">Load Average</div>
                    <div class="system-value" id="loadAverage">--</div>
                </div>
            </div>
        </div>
        
        <!-- Active Connections -->
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">üîó Active Connections</div>
            </div>
            <div class="metric-value" id="activeConnections">--</div>
            <div class="metric-change" id="connectionsChange">-- connections</div>
            <div class="systems-grid">
                <div class="system-item">
                    <div class="system-label">WebSocket</div>
                    <div class="system-value" id="wsConnections">--</div>
                </div>
                <div class="system-item">
                    <div class="system-label">AI Bridge</div>
                    <div class="system-value" id="aiBridgeConnections">--</div>
                </div>
                <div class="system-item">
                    <div class="system-label">Database</div>
                    <div class="system-value" id="dbConnections">--</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>LLM Framework Performance Dashboard v1.0.0 | Real-time monitoring powered by WebSocket</p>
    </div>
    
    <script>
        class PerformanceDashboard {
            constructor() {
                this.socket = null;
                this.charts = new Map();
                this.metrics = new Map();
                this.alertTimeout = null;
                
                this.initializeWebSocket();
                this.initializeCharts();
                this.startHeartbeat();
            }
            
            initializeWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const host = window.location.hostname;
                const port = 8081; // Performance monitor WebSocket port
                
                this.socket = new WebSocket(`${protocol}//${host}:${port}`);
                
                this.socket.onopen = () => {
                    console.log('Connected to performance monitor');
                    this.updateConnectionStatus('connected');
                };
                
                this.socket.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    this.handleMessage(message);
                };
                
                this.socket.onclose = () => {
                    console.log('Disconnected from performance monitor');
                    this.updateConnectionStatus('disconnected');
                    // Attempt to reconnect after 5 seconds
                    setTimeout(() => this.initializeWebSocket(), 5000);
                };
                
                this.socket.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.updateConnectionStatus('disconnected');
                };
            }
            
            handleMessage(message) {
                switch (message.type) {
                    case 'initial':
                        this.updateDashboard(message.data);
                        break;
                    case 'metric':
                        this.updateMetric(message.data);
                        break;
                    case 'system':
                        this.updateSystemMetrics(message.data);
                        break;
                    case 'alert':
                        this.showAlert(message.data);
                        break;
                }
                
                this.updateLastUpdateTime();
            }
            
            updateDashboard(data) {
                // Update system information
                if (data.system) {
                    this.updateSystemMetrics(data.system);
                }
                
                // Update metrics
                if (data.metrics) {
                    for (const [type, stats] of Object.entries(data.metrics)) {
                        this.updateMetricDisplay(type, stats);
                    }
                }
            }
            
            updateMetric(metric) {
                if (!this.metrics.has(metric.type)) {
                    this.metrics.set(metric.type, []);
                }
                
                const metricArray = this.metrics.get(metric.type);
                metricArray.push(metric);
                
                // Keep only recent data points (last 100)
                if (metricArray.length > 100) {
                    metricArray.splice(0, metricArray.length - 100);
                }
                
                // Update chart
                this.updateChart(metric.type, metricArray);
            }
            
            updateSystemMetrics(systemData) {
                // Memory
                document.getElementById('memoryUsage').innerHTML = 
                    `${systemData.memory.heapUsed.toFixed(1)}<span class="metric-unit">MB</span>`;
                
                // CPU (approximate)
                const cpuPercent = (systemData.cpu.usage / 1000) * 100;
                document.getElementById('cpuUsage').textContent = `${cpuPercent.toFixed(1)}%`;
                
                // System info
                document.getElementById('uptime').textContent = this.formatUptime(systemData.system.uptime);
                document.getElementById('platform').textContent = systemData.system.platform;
                document.getElementById('nodeVersion').textContent = systemData.system.nodeVersion;
                document.getElementById('loadAverage').textContent = systemData.cpu.loadAverage[0].toFixed(2);
                
                // Update status based on memory pressure
                this.updateSystemStatus(systemData.memory.pressure);
            }
            
            updateSystemStatus(memoryPressure) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                if (memoryPressure > 95) {
                    statusDot.className = 'status-dot critical';
                    statusText.textContent = 'Critical: High Memory Pressure';
                } else if (memoryPressure > 80) {
                    statusDot.className = 'status-dot warning';
                    statusText.textContent = 'Warning: Elevated Memory Usage';
                } else {
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'System Operating Normally';
                }
            }
            
            updateConnectionStatus(status) {
                const element = document.getElementById('connectionStatus');
                element.className = `connection-status ${status}`;
                element.textContent = status === 'connected' ? 'Connected' : 'Disconnected';
            }
            
            showAlert(alertData) {
                const alertPanel = document.getElementById('alertPanel');
                const alertTitle = document.getElementById('alertTitle');
                const alertMessage = document.getElementById('alertMessage');
                
                alertTitle.textContent = `${alertData.level.toUpperCase()} ALERT`;
                alertMessage.textContent = 
                    `${alertData.metric}: ${alertData.value} exceeds ${alertData.threshold} threshold`;
                
                alertPanel.classList.add('show');
                
                // Auto-hide after 10 seconds
                if (this.alertTimeout) {
                    clearTimeout(this.alertTimeout);
                }
                
                this.alertTimeout = setTimeout(() => {
                    alertPanel.classList.remove('show');
                }, 10000);
            }
            
            updateLastUpdateTime() {
                const now = new Date();
                document.getElementById('lastUpdate').textContent = 
                    `Last updated: ${now.toLocaleTimeString()}`;
            }
            
            formatUptime(seconds) {
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (days > 0) {
                    return `${days}d ${hours}h`;
                } else if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            }
            
            initializeCharts() {
                // Initialize canvas elements for charts
                const chartIds = ['memoryChart', 'cpuChart', 'apiChart', 'memoryOpsChart'];
                chartIds.forEach(id => {
                    const canvas = document.getElementById(id);
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        canvas.width = canvas.offsetWidth;
                        canvas.height = canvas.offsetHeight;
                        this.charts.set(id, { canvas, ctx });
                    }
                });
            }
            
            updateChart(metricType, data) {
                // Simple line chart implementation
                let chartId;
                switch (metricType) {
                    case 'system.memory.heap_used':
                        chartId = 'memoryChart';
                        break;
                    case 'system.cpu.usage':
                        chartId = 'cpuChart';
                        break;
                    case 'api.response_time':
                        chartId = 'apiChart';
                        break;
                    case 'memory.operation_time':
                        chartId = 'memoryOpsChart';
                        break;
                    default:
                        return;
                }
                
                const chart = this.charts.get(chartId);
                if (!chart) return;
                
                const { canvas, ctx } = chart;
                const width = canvas.width;
                const height = canvas.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                if (data.length < 2) return;
                
                // Find min/max for scaling
                const values = data.map(d => d.value);
                const min = Math.min(...values);
                const max = Math.max(...values);
                const range = max - min || 1;
                
                // Draw line chart
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                data.forEach((point, index) => {
                    const x = (index / (data.length - 1)) * width;
                    const y = height - ((point.value - min) / range) * height;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
                
                // Add glow effect
                ctx.shadowColor = '#00d4ff';
                ctx.shadowBlur = 10;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
            
            startHeartbeat() {
                // Send periodic heartbeat to keep connection alive
                setInterval(() => {
                    if (this.socket && this.socket.readyState === WebSocket.OPEN) {
                        this.socket.send(JSON.stringify({ type: 'heartbeat' }));
                    }
                }, 30000); // 30 seconds
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new PerformanceDashboard();
        });
    </script>
</body>
</html>