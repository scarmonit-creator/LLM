<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Mail.tm Account</title>
</head>
<body>
  <h1>Create a Mail.tm Account</h1>
  <p>This page calls the Mail.tm API to create a new temporary email account.</p>
  <button id="runBtn">Create Account</button>
  <pre id="result" style="white-space: pre-wrap; background: #f3f3f3; padding: 1em;"></pre>
  <script>
    async function run() {
      const resultEl = document.getElementById('result');
      resultEl.textContent = 'Creating account...';
      try {
        // Use cryptographically secure random number generation
        const randomValues = new Uint32Array(1);
        window.crypto.getRandomValues(randomValues);
        const username = 'assistant' + (randomValues[0] % 1000000);
        const address = `${username}@tiffincrane.com`;
        const password = 'AssistantDemo123!';
        const res = await fetch('https://api.mail.tm/accounts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ address, password })
        });
        if (!res.ok) {
          resultEl.textContent = `Error: ${res.status} ${res.statusText}`;
          const errData = await res.text().catch(() => '');
          resultEl.textContent += '\n' + errData;
          return;
        }
        const data = await res.json();
        resultEl.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        resultEl.textContent = 'Error: ' + e.toString();
      }
    }
    document.getElementById('runBtn').addEventListener('click', run);
  </script>
</body>
</html>
